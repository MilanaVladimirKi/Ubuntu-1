# Ubuntu 1. 

## Основные команды создания и редактирования пользователей.

##### Добавление пользователя осуществляется при помощи команды useradd 

Для вызовы команды необходимы права суперпользователя. Ддля использование прав суперпользователя есть команда sudo 
Пример: sudo useradd student

Настройки для пользователя по умолчанию можно посмотреть, выполнив команду useradd -D

##### Поменять настройки пользователя можно выполнив useradd -D -s /bin/bash

Изменение параметров пользователя происходит с помощью утилиты usermod. Пример: usermod -c «комментарий пользователю» stu

##### Изменить пароль пользователю можно при помощи утилиты passwd. Для ее выполнения необходимы права суперпользователя. 
Пример: sudo passwd stu

Команда passwd может использоваться и обычным пользователем для смены собственного пароля. 
Для этого пользователю надо ввести passwd и ввести старый и новый пароли.

Суперпользователь с помощью утилит командной строки passwd и usermod может удалить пароль пользователь, дав возможность входить в систему без указания пароля. 
ПРимеры: sudo passwd -d stu или sudo usermod -p "" stu

##### Для удаления пользователя используется команда userdel. Для её использования необходимы права суперпользователя. 
Пример: sudo userdel stu
Дополнительно: 
Ключ -f Принудительно удалит пользователя, даже если он сейчас работает в системе. Пример: sudo userdel -f student
Ключ -r Удалит домашний каталог пользователя. Пример: sudo userdel -r student

Команда users сделает вывод имен пользователей, работающих в системе. id имя_пользователя – вывод информации о пользователе: его uid, имя_пользователя, gid (идентификационный номер группы) и имя первичной группы, список групп в которых состоит пользователь. 

Команда groups имя_пользователя сделает вывод списка групп, членом которых является пользователь.

## Основные команды создания и редактирования групп. 

Команда groupadd создаёт новую группу согласно указанным значениям командной строки и системным значениям по умолчанию. Для выполнения команды необходимы права суперпользователя. Пример: sudo groupadd testgroup
Ключ -g установит собственный GID (Идентификатор группы (Group ID)). 
Ключ -p задаст Пароль группы.
Ключ -r Создаст системную группу.

Сменить название группы, ее идентификационный номер (GID) или пароль можно при помощи команды groupmod. 
Для выполнения команды необходимы права суперпользователя. Пример: sudo groupmod -n newtestgroup testgroup 
Результат: Имя группы изменено с testgroup на newtestgroup 
Ключ -n установит Новое имя группы.
Ключ -p Изменит пароль группы.
Ключ -g Установит другой GID. Пример: sudo groupmod -g 8000 testgroup 

Удаление группы производится с помощью команды groupdel. Для выполнения команды необходимы права суперпользователя.
Пример: sudo groupdel testgroup

## Формат файла /etc/passwd. 

/etc/passwd (от англ. password — пароль) — файл, содержащий в текстовом формате список пользовательских учётных записей (аккаунтов). Является первым и основным источником информации о правах пользователя операционной системы. Существует в большинстве версий и вариантов UNIX-систем.

У файла /etc/passwd следующие права доступа: чтение и запись для root, для остальных – только чтение.

Файл /etc/passwd может читать любой пользователь. 

Вся информация об учетной записи пользователя хранится в файле /etc/passwd. 
Чтобы просмотреть список пользователей, можно использовать команду: cat /etc/passwd

account:password:UID:GID:GECOS:directory:shell
где:
– account – имя пользователя;
– password – пароль пользователя;
– UID – идентификационный номер пользователя;
– GID – идентификационный номер основной группы пользователя;
– GECOS – необязательное поле, используемое для указания дополнительной информации о пользователе (например, полное имя пользователя);
– directory – домашний каталог ($HOME) пользователя;
– shell – командный интерпретатор пользователя (часто /bin/sh).

Символ «x» в поле пароля означает, что в системе используются теневые пароли и пароль пользователя хранится в файле etc/shadow 

![пример](https://sun9-27.userapi.com/impf/yT3aJ9vc4U4Gz7u9bMZG4u2u1NCxE1H3oeE0XQ/nMFDHEnB8JM.jpg?size=511x76&quality=95&sign=bd84a5b1b0a4160c76914050e68d2835&type=album)

Есть имя каждого пользовател, пароль отмечан как "х", есть ID каждого пользователя и ID основной группы. У студента была переопределена группа, Иванов изначально был записан в группу студент, остальные пользователи входят в именые группы. 

## Формат файла /etc/shadow. 

etc/shadow – в этом файле хранятся "теневые пароли", информация о паролях пользователей в зашифрованном виде.

![пример](https://sun9-29.userapi.com/impf/DQKVlQsXnE6jlC-maPfy6EEkRaCEjPLyQQoYDQ/yFAJA7XripA.jpg?size=1215x79&quality=95&sign=3d617ed099dd05697ff207b66ab3a48f&type=album)

Есть имя каждого пользователя, пароль в зашифрованном виде, 19806 - дата последнего изменения пароля, 0 - мин. колличество дней, есть максимальное... нет последних 2 значений. Но они и не обязательны

Файл /etc/shadow может читать только root 

Каждая строка файла содержит поля:
– регистрационное имя;
– пароль в зашифрованном виде;
– дата последнего изменения пароля;
– минимальное количество дней между изменениями пароля;
– максимальное количество дней между изменениями пароля;
– количество дней до выдачи сообщения об окончании срока действия пароля;
– количество дней (по истечению срока действия пароля) до автоматического аннулирования учётной записи;
– период действия учётной записи;
– зарезервированное поле.

Обязательными являются первые два поля. Формат полей дат соответствует количеству дней, прошедших с первого января 1970 года.

Символ «*» в поле пароля устанавливается только у системных пользователей и означает, что нельзя войти в систему от имени системного пользователя. 

Если перед хэшем пароля расположен символ «!», то это означает, что пароль и учетная запись заблокированы и пользователь не сможет войти в систему. 
Если после знака “!” нет хэша, то пароль не установлен и учетная запись временно заблокирована до тех пор, пока не установят пароль. 

## Формат файла /etc/group. 

/etc/group это файл, который описывает группы, членами которых являются пользователи. 

Информация о каждой группе содержится в отдельной строке. Строка имеет следующий формат: 

![пример](https://sun9-48.userapi.com/impf/pm0kLAtrtb4nvmeAeDTcZnSoky1PWcoaQLg0Jg/52LmA7wL9QA.jpg?size=321x102&quality=95&sign=a30daf721d95b398cf52b53f5c727b6d&type=album)svg 

Есть имя группы, есть пароль и номер группы. 

У файла /etc/group следующие права доступа: чтение и запись для root, для остальных – только чтение.

## Формат файла /etc/gshadow. 

etc/gshadow – то же самое что и shadow, только для паролей групп.

Каждая строка файла содержит информацию о пароле группы в формате:

– имя группы;
– зашифрованный пароль;
– администраторы через запятую;
– обычные пользователи через запятую. 

Символ «*» присутствует в поле пароля у системных групп. Пароли этих групп может менять только суперпользователь.
Когда пароль устанавливается для системных групп, то знак «*» сменяется на зашифрованный пароль.

## Каталог /etc/skel/ 

Каталог /etc/skel/ - (skel является производным от «skeleton») используется для запуска домашнего каталога при первом создании пользователя.
 
В каталоге хранятся файлы, которые необходимы каждому пользователю, имеющему свой домашний каталог. 
При создании учетной записи все файлы данного каталога автоматически копируются в домашний каталог нового пользователя. 
Все файлы скрытые.

## Процесс регистрации пользователя вручную, путем редактирования конфигурационных файлов. 

1. Чтобы вручную добавить нового пользователя в систему в файл /etc/passwd, добавьте следующую строку: 

testuser:x:3000:3000:test user:/home/testuser:/bin/bash

Результат: 
Добавлен пользователь «testuser» с идентификатором 3000.
Пользователь добавлен в группу с таким же идентификатором, которая еще не создана. 
У пользователя установлен комментарий, гласящий «test user», домашний каталог установлен как "/home/testuser", а командная оболочка – как "/bin/bash". 
Cохраните файл. 

![1](https://sun9-9.userapi.com/impg/6WZOznoQf1RzgMO4VjwxtCVvpSBWTW75LKGliQ/j2M0Q0XOqG0.jpg?size=896x884&quality=95&sign=c5a53bafa37e0fcc2d1be48ebe0dd16e&type=album)

2. Необходимо добавить запись в /etc/shadow для этого пользователя. 

Скопируйте строку какого-нибудь существующего пользователя, например, 
drobbins: $1$1234567890123456789012345678901:11664:0:-1:-1:-1:-1:0 

Замените имя пользователя в скопированной строке на имя вашего пользователя и убедитесь что все поля (особенно старый пароль) установлены:
testuser: $1$1234567890123456789012345678901:11664:0:-1:-1:-1:-1:0
Сохраните внесенные изменения. 

![2](https://sun9-47.userapi.com/impg/pLA7tMboC7MR_TM_ZjtAS0CA6vRAupTV1PSlIQ/2WnGFwTis74.jpg?size=457x137&quality=95&sign=98197c7958618f1c9b808838a5939816&type=album)


3. Теперь необходимо определить пароль для нового пользователя. 

Введите в командной строке команду passwd testuser и определите пароль пользователя. 

![3](https://sun9-47.userapi.com/impg/pLA7tMboC7MR_TM_ZjtAS0CA6vRAupTV1PSlIQ/2WnGFwTis74.jpg?size=457x137&quality=95&sign=98197c7958618f1c9b808838a5939816&type=album)

4. Если решено добавить созданного пользователя к уже имеющейся группе, то не понадобиться создавать новую группу в /etc/groups 
Если это не так, то необходимо добавить новую группу для этого пользователя, введя в файл следующую строку: 
testuser:x:3000: 

![4](https://sun9-20.userapi.com/impg/rTZx3dEvUj3Kp00LWb8ae6GRon-stE1glLG_lg/_Fi1mXeGjeE.jpg?size=273x117&quality=95&sign=29112886bcc013ecb40c3faee1c3fb8d&type=album)

5. Для создания домашнего каталога нового пользователя выполните следующие команды:

 cd /home

 mkdir testuser

 chown testuser:testuser testuser

 chmod o-rwx testuser 

![5](https://sun9-21.userapi.com/impg/JhL3DLrA9cEirTbejAwC9cbP16r3S6JqJ1680g/MZBDpfhXNs4.jpg?size=638x93&quality=95&sign=2d8265fd6b03b6507eff71bcf8f7fdb0&type=album)


6. Во время входа пользователя в систему, до появления у него командной строки, происходит целый ряд событий.
После ввода регистрационного имени и пароля система проверяет, может ли пользователь войти в систему. 
С этой целью используется содержимое файла /etc/passwd.

7. После успешной регистрации выполняются два файла: /etc/profile и файл .profile, расположенный в домашнем каталоге пользователя. 
Существуют и другие исполняемые файлы инициализации. 

## Файлы /etc/profile и $HOME/.profile 

Информация файла профиля /etc/profile используется при входе в систему каждого пользователя. 
Этот файл обычно содержит:
- глобальные или локальные переменные среды;
- информацию о пути к файлам в переменной PATH;
- параметры терминала;
- меры безопасности;
- советы дня или сведения о причинах отказа.

После выполнения /etc/profile пользователь попадает в свой домашний каталог $HOME. 
В этом каталоге хранится вся личная информация пользователя. 
Если в $HOME имеется файл .profile, система использует его в качестве исходного файла. 
Установки /etc/profile могут быть переопределены при добавлении в файл .profile нового элемента с другим значением либо при выполнении команды unset. 
Настройка файла .profile остается в распоряжении пользователя. 

8. Можно удалить пользователя 

![Удаление](https://sun9-61.userapi.com/impg/u31dfnu8-7hvNgsUpNQmu7JyG7NyJXO_f266Iw/wB5D6mI-uSw.jpg?size=898x895&quality=95&sign=6e0cf453c152612df2d46a9bb37304fc&type=album)

И снова создать с помощью gebit

![скрины](https://sun9-38.userapi.com/impf/LbM5P_pOR-jXBI592Okgkm_Itu_iSRP7HsVSHg/cDX_oIxTJYY.jpg?size=1200x1500&quality=95&sign=8e42fd609d04786635d2063872fa46d9&type=album)